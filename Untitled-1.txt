#!/bin/bash -
#title          :Reset SPA CA
#description    :Delete all certifiactes, keys and store files generated by SPA CA and reset CA database
#author         :Sapnesh Naik
#date           :20190815
#version        :0.1
#usage          :./reset_ca.sh
#notes          :
#bash_version   :4.2.46(2)-release
#============================================================================

Red=`tput setaf 1`
Green=`tput setaf 2`
White=`tput setaf 7`
Yellow=`tput setaf 3`
Bold=`tput bold`
NC=`tput sgr0`


read -n 1 -r -p "${Bold}This operation will delete all CA genertaed certificates, keystores, truststores and private keys. Are you sure?(y/n) ${NC}"
echo    # (optional) move to a new line
if [[ $REPLY =~ ^[Yy]$ ]]
then
    rm ./CA/CA.log ./CA/certindex.txt.* ./CA/serial.old
    find ./deployment_files/CA -name "*.pem" -type f -delete
    find ./deployment_files/CA -name "*.p12" -type f -delete
    > ./CA/certindex.txt
    echo "100001" > ./CA/serial
    echo "CA reset successful"
fi